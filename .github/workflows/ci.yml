name: Minishell CI

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  build-and-test:
    name: Build & Run external tester
    runs-on: ubuntu-latest

    steps:
      
      - name: Checkout repository
        uses: actions/checkout@v4

     
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential libreadline-dev python3

     
      - name: Build Minishell
        run: |
          make clean
          make
          if [ ! -f minishell ]; then
            echo "âŒ Build failed!"
            exit 1
          fi
          echo "âœ… Build success!"

     
      - name: Verify executable
        run: |
          ./minishell --version || echo "âš ï¸ Minishell ran but returned error"

     
      - name: Run external tester
        run: |
          cd tests/test1
          chmod +x run_tests.sh 2>/dev/null || true
          chmod +x test.sh 2>/dev/null || true
          echo "ğŸ§ª Running tester..."
          if [ -f run_tests.sh ]; then
            ./run_tests.sh || echo "âŒ Some tests failed"
          elif [ -f test.sh ]; then
            ./test.sh || echo "âŒ Some tests failed"
          elif [ -f main.py ]; then
            python3 main.py || echo "âŒ Some tests failed"
          else
            echo "âš ï¸ No known test entry found (run_tests.sh/test.sh/main.py)"
          fi
