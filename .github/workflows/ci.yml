name: Minishell CI

on: [push, pull_request]

jobs:
  build-and-test:
    name: Build & Run external tester
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential libreadline-dev python3

      # 3Ô∏è‚É£ –°–æ–±–∏—Ä–∞–µ–º Minishell
      - name: Build Minishell
        run: make

      # 4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –±–∏–Ω–∞—Ä–Ω–∏–∫ —Å–æ–±—Ä–∞–Ω
      - name: Verify executable
        run: |
          if [ ! -f minishell ]; then
            echo "‚ùå Build failed!"
            exit 1
          fi
          echo "‚úÖ Build success!"

      # 5Ô∏è‚É£ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –∏–∑ tests/test1
      - name: Run external tester
        run: |
          cd tests/test1
          echo "üß™ Running tester..."
          if [ -f run_tests.sh ]; then
            bash run_tests.sh || true
          elif [ -f test.sh ]; then
            bash test.sh || true
          elif [ -f main.py ]; then
            python3 main.py || true
          else
            echo "‚ö†Ô∏è No known test entry found (run_tests.sh/test.sh/main.py)"
          fi

